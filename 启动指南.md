# 启动指南

## 快速启动步骤

### 1. 启动后端服务

打开终端，进入后端目录：

```bash
cd backend

# 创建虚拟环境（首次运行）
python -m venv venv

# 激活虚拟环境
# Linux/Mac:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# 安装依赖（首次运行）
pip install -r requirements.txt

# 启动服务
python -m app.main
```

看到以下信息表示启动成功：
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### 2. 获取电脑IP地址

后端服务启动后，需要获取电脑的IP地址以便手机连接：

#### Linux/Mac:
```bash
ifconfig | grep "inet "
# 或
ip addr show
```

#### Windows:
```bash
ipconfig
```

找到类似 `192.168.x.x` 的局域网IP地址（不是 127.0.0.1）。

### 3. 启动前端应用

打开新的终端，进入前端目录：

```bash
cd frontend

# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm start
```

### 4. 运行应用

在 Expo 开发服务器启动后：

- **Android**: 按 `a` 键，或使用 Expo Go 应用扫描二维码
- **iOS**: 按 `i` 键，或使用 Expo Go 应用扫描二维码  
- **Web**: 按 `w` 键在浏览器中打开

### 5. 配置API地址

首次运行应用时：

1. 打开应用的"设置"标签页
2. 在"API地址"输入框中输入：`http://你的电脑IP:8000`
   - 例如：`http://192.168.1.100:8000`
3. 点击"测试连接"按钮
4. 看到"连接成功"后，点击"保存"

### 6. 开始使用

1. 在"首页"输入专辑ID（例如：350234）
2. 点击"开始下载"
3. 在"下载"标签页查看下载进度
4. 下载完成后，在"收藏"标签页查看已下载的专辑

## 常见问题

### 后端启动失败

**问题**: `ModuleNotFoundError: No module named 'xxx'`

**解决**: 
```bash
pip install -r requirements.txt
```

**问题**: 端口被占用

**解决**: 
- 修改 `backend/app/config.py` 中的 `API_PORT`
- 或使用环境变量：`API_PORT=8001 python -m app.main`

### 前端无法连接后端

**问题**: 显示"未连接"

**检查项**:
1. ✅ 后端服务是否正在运行？
2. ✅ API地址是否正确？（必须使用IP，不能用localhost）
3. ✅ 手机和电脑是否在同一个WiFi网络？
4. ✅ 防火墙是否阻止了8000端口？

**解决**:
- 确保使用电脑的局域网IP地址（192.168.x.x）
- 检查防火墙设置，允许8000端口
- 尝试在手机浏览器中访问：`http://你的IP:8000/health`

### 下载失败

**问题**: 下载任务一直显示"下载中"

**解决**:
- 检查后端终端是否有错误信息
- 确认专辑ID是否正确
- 检查网络连接

## 测试后端API

可以在浏览器或使用 curl 测试后端API是否正常工作：

```bash
# 健康检查
curl http://localhost:8000/health

# 查看API文档
# 在浏览器打开: http://localhost:8000/docs
```

## 开发模式

### 后端自动重载
后端使用了 `--reload` 参数，代码修改后会自动重载。

### 前端热重载
前端使用 Expo 的开发模式，代码修改后会自动刷新。

## 生产环境部署

### 后端

```bash
# 不使用reload模式
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 前端

需要构建原生应用，参考：
- [Expo Build Documentation](https://docs.expo.dev/build/introduction/)

