# 网络连接错误故障排除

## 错误信息
```
健康检查失败: AxiosError: Network Error
```

## 常见原因和解决方案

### 1. 后端服务未启动

**检查方法**：
在电脑上打开浏览器访问：`http://localhost:8000/health`

**如果无法访问**：
```bash
cd backend
python -m app.main
```

确保看到类似输出：
```
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### 2. API地址配置错误

**问题**：使用了 `localhost` 或 `127.0.0.1`

**原因**：手机上的 `localhost` 指向手机自己，而不是运行后端的电脑

**解决方案**：
1. 获取电脑的IP地址：
   ```bash
   # Linux/Mac
   ifconfig | grep "inet " | grep -v 127.0.0.1
   
   # 或
   ip addr show | grep "inet " | grep -v 127.0.0.1
   
   # Windows
   ipconfig
   ```
   找到类似 `192.168.x.x` 的地址

2. 在应用设置中配置：
   - 打开应用的"设置"标签页
   - 在"API地址"输入框中输入：`http://你的电脑IP:8000`
   - 例如：`http://192.168.1.100:8000`
   - 点击"测试连接"
   - 连接成功后点击"保存"

### 3. 手机和电脑不在同一网络

**检查**：
- 确保手机和电脑连接在同一个WiFi网络
- 确保WiFi网络允许设备间通信（某些公共WiFi可能禁止）

**解决方案**：
- 将手机和电脑连接到同一个WiFi
- 如果是公共WiFi，考虑使用手机热点

### 4. 防火墙阻止连接

**检查**：
- Windows防火墙可能阻止了8000端口
- Linux防火墙（ufw/iptables）可能阻止了端口

**解决方案**：

**Windows**：
```powershell
# 允许8000端口（管理员权限运行）
netsh advfirewall firewall add rule name="JM API" dir=in action=allow protocol=TCP localport=8000
```

**Linux**：
```bash
# Ubuntu/Debian (ufw)
sudo ufw allow 8000/tcp

# 或使用iptables
sudo iptables -A INPUT -p tcp --dport 8000 -j ACCEPT
```

### 5. 后端未绑定到0.0.0.0

**检查** `backend/app/config.py` 或启动命令：
```python
# 确保host是0.0.0.0而不是127.0.0.1
API_HOST = "0.0.0.0"  # ✅ 正确
# API_HOST = "127.0.0.1"  # ❌ 错误，只能本地访问
```

### 6. 测试连接

#### 在电脑上测试
```bash
curl http://localhost:8000/health
```

#### 在手机上测试
1. 在手机浏览器中输入：`http://你的电脑IP:8000/health`
2. 如果能看到 `{"status":"healthy"}`，说明网络连接正常
3. 如果无法访问，检查上述1-5项

## 快速诊断步骤

1. ✅ **后端是否运行？**
   - 访问 `http://localhost:8000/health`

2. ✅ **获取电脑IP地址**
   - Linux/Mac: `ifconfig` 或 `ip addr show`
   - Windows: `ipconfig`

3. ✅ **配置正确的API地址**
   - 格式：`http://电脑IP:8000`
   - 不要使用 `localhost` 或 `127.0.0.1`

4. ✅ **测试手机网络连接**
   - 在手机浏览器访问：`http://电脑IP:8000/health`

5. ✅ **检查防火墙**
   - 确保8000端口未被阻止

## 常见IP地址格式

- ✅ **正确**: `http://192.168.1.100:8000`
- ✅ **正确**: `http://10.0.0.5:8000`
- ❌ **错误**: `http://localhost:8000`
- ❌ **错误**: `http://127.0.0.1:8000`

## 如果仍然无法连接

1. 检查后端日志是否有错误
2. 尝试修改后端端口（修改 `backend/app/config.py` 中的 `API_PORT`）
3. 检查路由器设置，确保允许设备间通信
4. 尝试使用电脑创建移动热点，手机连接热点

